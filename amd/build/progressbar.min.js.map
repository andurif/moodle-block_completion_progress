{"version":3,"sources":["../src/progressbar.js"],"names":["define","$","showInfo","event","cell","container","closest","visibleinfo","siblings","infotoshow","data","is","hide","show","preventDefault","showAllInfo","initialinfo","viewActivity","infolink","find","document","location","prop","setupScroll","barcontainer","nowicon","leftarrow","rightarrow","checkArrows","scrolled","scrollWidth","css","scrollContainer","amount","length","offset","left","width","click","window","resize","initialiseBar","instanceid","on","init","instanceids","i"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Completion Progress block progress bar behaviour.\n *\n * @module     block_completion_progress/progressbar\n * @package    block_completion_progress\n * @copyright  2020 Jonathon Fowler <fowlerj@usq.edu.au>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'],\n    function($) {\n        /**\n         * Show progress event information for a cell.\n         */\n        function showInfo(event) {\n            var cell = $(this);\n            var container = cell.closest('.block_completion_progress .barContainer');\n            var visibleinfo = container.siblings('.progressEventInfo:visible');\n            var infotoshow = container.siblings('#' + cell.data('infoId'));\n\n            if (!visibleinfo.is(infotoshow)) {\n                visibleinfo.hide();\n                infotoshow.show();\n            }\n\n            event.preventDefault();\n        }\n\n        /**\n         * Show all progress event information (for accessibility).\n         * @param {Event} event\n         */\n        function showAllInfo(event) {\n            var initialinfo = $(this).closest('.progressEventInfo');\n\n            initialinfo.siblings('.progressEventInfo').show();\n            initialinfo.hide();\n\n            event.preventDefault();\n        }\n\n        /**\n         * Navigate to a cell's activity location.\n         */\n        function viewActivity() {\n            var cell = $(this);\n            var container = cell.closest('.block_completion_progress .barContainer');\n            var infotoshow = container.siblings('#' + cell.data('infoId'));\n            var infolink = infotoshow.find('a.action_link');\n            document.location = infolink.prop('href');\n        }\n\n        /**\n         * Prepare scroll mode behaviour.\n         * @param {jQuery} barcontainer\n         */\n        function setupScroll(barcontainer) {\n            var nowicon = barcontainer.find('.nowicon');\n            var leftarrow = barcontainer.find('.left-arrow-svg');\n            var rightarrow = barcontainer.find('.right-arrow-svg');\n\n            /**\n             * Positions the scroll arrows.\n             */\n            function checkArrows() {\n                var threshold = 10, buffer = 5;\n                var scrolled = barcontainer.prop('scrollLeft');\n                var scrollWidth = barcontainer.prop('scrollWidth') - barcontainer.prop('offsetWidth');\n\n                if (scrolled > threshold) {\n                    leftarrow.css({\n                        'display': 'block',\n                        'left': (scrolled + buffer) + 'px'\n                    });\n                } else {\n                    leftarrow.css('display', 'none');\n                }\n                if (scrollWidth > threshold && scrolled < scrollWidth - threshold) {\n                    rightarrow.css({\n                        'display': 'block',\n                        'right': (buffer - scrolled) + 'px'\n                    });\n                } else {\n                    rightarrow.css('display', 'none');\n                }\n            }\n\n            /**\n             * Scroll the bar.\n             * @param {Event} event\n             */\n            function scrollContainer(event) {\n                var amount = event.data * barcontainer.prop('scrollWidth') * 0.15;\n\n                barcontainer.prop('scrollLeft', barcontainer.prop('scrollLeft') + amount);\n                checkArrows();\n\n                event.preventDefault();\n            }\n\n            if (nowicon.length > 0) {\n                // Place the 'now' marker in the centre of the scrolled bar.\n                barcontainer.prop('scrollLeft', 0);\n                barcontainer.prop('scrollLeft', nowicon.offset().left\n                    - barcontainer.offset().left - barcontainer.width() / 2);\n            }\n\n            leftarrow.click(-1, scrollContainer);\n            rightarrow.click(1, scrollContainer);\n            $(window).resize(checkArrows);\n            checkArrows();\n        }\n\n        /**\n         * Set up event handlers for a particular progress bar instance.\n         * @param {integer} instanceid the bar instance id\n         */\n        function initialiseBar(instanceid) {\n            var barcontainer = $('.block_completion_progress ' +\n                '.barContainer[data-instanceid=\"' + instanceid + '\"]');\n\n            // Show information elements on hover or tap.\n            barcontainer.on('touchstart mouseover', '.progressBarCell', showInfo);\n\n            // Navigate to the activity when its cell is clicked.\n            barcontainer.on('click', '.progressBarCell[data-haslink=true]', viewActivity);\n\n            // Show all information elements when the 'show all' link is clicked.\n            barcontainer.siblings('.progressEventInfo').find('.progressShowAllInfo').click(showAllInfo);\n\n            setupScroll(barcontainer);\n        }\n\n        return /** @alias module:block_completion_progress/progressbar */ {\n            /**\n             * Initialise progress bar instances.\n             * @param {array} instanceids an array of progress bar instance ids\n             */\n            init: function(instanceids) {\n                for (var i = instanceids.length - 1; i >= 0; i--) {\n                    initialiseBar(instanceids[i]);\n                }\n            },\n        };\n    });\n"],"file":"progressbar.min.js"}